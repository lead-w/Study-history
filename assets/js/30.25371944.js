(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{196:function(t,n,s){"use strict";s.r(n);var a=s(0),e=Object(a.a)({},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p"),t._m(1),s("p"),t._v(" "),t._m(2),t._v(" "),s("ul",[s("li",[t._v("安装模块")]),t._v(" "),s("li",[t._v("yum  -y install gcc gcc-c++ autoconf pcre pcre-devel make automake")]),t._v(" "),s("li",[t._v("yum  -y install wget httpd-tools vim")]),t._v(" "),s("li",[s("a",{attrs:{href:"http://nginx.org/en/linux_packages.html#stable",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx安装文档"),s("OutboundLink")],1)])]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._m(42),t._v(" "),t._m(43),t._v(" "),t._m(44),t._v(" "),t._m(45),t._v(" "),t._m(46),t._v(" "),t._m(47),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._m(57),t._v(" "),t._m(58),t._v(" "),t._m(59),t._m(60),t._v(" "),t._m(61),t._v(" "),t._m(62),t._m(63),t._v(" "),t._m(64),t._v(" "),t._m(65),t._m(66),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69),t._m(70),t._m(71),t._v(" "),t._m(72),t._v(" "),t._m(73),t._m(74),t._m(75),t._v(" "),t._m(76),t._m(77),t._v(" "),t._m(78),t._m(79),t._v(" "),t._m(80),t._v(" "),t._m(81),t._m(82),t._v(" "),t._m(83),t._v(" "),t._m(84),t._m(85),t._v(" "),t._m(86),t._v(" "),t._m(87),t._v(" "),t._m(88),t._m(89),t._v(" "),t._m(90),t._v(" "),t._m(91),t._m(92),t._v(" "),t._m(93),t._v(" "),t._m(94),t._m(95),t._v(" "),t._m(96),t._v(" "),s("img",{attrs:{src:t.$withBase("/img/location.jpg")}}),t._v(" "),t._m(97),t._v(" "),t._m(98),t._v(" "),t._m(99),t._m(100),t._v(" "),t._m(101),t._v(" "),t._m(102),t._m(103),t._v(" "),t._m(104),t._m(105),t._v(" "),t._m(106),t._m(107),t._v(" "),t._m(108),t._m(109),t._v(" "),t._m(110),t._v(" "),t._m(111),t._v(" "),t._m(112),t._m(113),t._v(" "),t._m(114),t._m(115),t._v(" "),t._m(116),t._v(" "),t._m(117),t._m(118),t._v(" "),t._m(119),t._v(" "),t._m(120),t._m(121),t._v(" "),t._m(122),t._v(" "),t._m(123),t._v(" "),t._m(124),t._v(" "),t._m(125),t._m(126),t._v(" "),t._m(127),t._v(" "),t._m(128),s("p",[t._v("limit_conn 限制域")]),t._v(" "),t._m(129),t._m(130),t._v(" "),t._m(131),t._v(" "),s("p",[t._v("limit_req 限制并发请求数")]),t._v(" "),t._m(132),t._m(133),t._v(" "),t._m(134),t._m(135),t._v(" "),t._m(136),t._v(" "),t._m(137)])},[function(){var t=this.$createElement,n=this._self._c||t;return n("h1",{attrs:{id:"nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx","aria-hidden":"true"}},[this._v("#")]),this._v(" nginx")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#安装"}},[t._v("安装")])]),s("li",[s("a",{attrs:{href:"#centos下yum安装"}},[t._v("CentOS下YUM安装")])]),s("li",[s("a",{attrs:{href:"#nginx-架构"}},[t._v("nginx 架构")]),s("ul",[s("li",[s("a",{attrs:{href:"#工作流程"}},[t._v("工作流程")])])])]),s("li",[s("a",{attrs:{href:"#安装目录"}},[t._v("安装目录")])]),s("li",[s("a",{attrs:{href:"#日志切割文件"}},[t._v("日志切割文件")]),s("ul",[s("li",[s("a",{attrs:{href:"#日志存放"}},[t._v("日志存放")])]),s("li",[s("a",{attrs:{href:"#日志类型"}},[t._v("日志类型")])]),s("li",[s("a",{attrs:{href:"#内置变量"}},[t._v("内置变量")])]),s("li",[s("a",{attrs:{href:"#http请求变量"}},[t._v("HTTP请求变量")])])])]),s("li",[s("a",{attrs:{href:"#nginx-命令"}},[t._v("nginx 命令")]),s("ul",[s("li",[s("a",{attrs:{href:"#值指令继承规则"}},[t._v("值指令继承规则")])])])]),s("li",[s("a",{attrs:{href:"#主配置文件"}},[t._v("主配置文件")]),s("ul",[s("li",[s("a",{attrs:{href:"#server"}},[t._v("server")])])])]),s("li",[s("a",{attrs:{href:"#启动和重新加载"}},[t._v("启动和重新加载")])]),s("li",[s("a",{attrs:{href:"#静态资源服务器"}},[t._v("静态资源服务器")])]),s("li",[s("a",{attrs:{href:"#cdn"}},[t._v("CDN")])]),s("li",[s("a",{attrs:{href:"#语法配置"}},[t._v("语法配置")]),s("ul",[s("li",[s("a",{attrs:{href:"#sendfile"}},[t._v("sendfile")])]),s("li",[s("a",{attrs:{href:"#tcp-nopush"}},[t._v("tcp_nopush")])]),s("li",[s("a",{attrs:{href:"#tcp-nodelay"}},[t._v("tcp_nodelay")])]),s("li",[s("a",{attrs:{href:"#gzip"}},[t._v("gzip")])]),s("li",[s("a",{attrs:{href:"#gzip-comp-level"}},[t._v("gzipcomplevel")])]),s("li",[s("a",{attrs:{href:"#gzip-http-version"}},[t._v("gziphttpversion")])]),s("li",[s("a",{attrs:{href:"#http-gzip-static-module"}},[t._v("httpgzip-staticmodule")])])])]),s("li",[s("a",{attrs:{href:"#实战"}},[t._v("实战")]),s("ul",[s("li",[s("a",{attrs:{href:"#防盗链"}},[t._v("防盗链")])]),s("li",[s("a",{attrs:{href:"#跨域"}},[t._v("跨域")])]),s("li",[s("a",{attrs:{href:"#浏览器缓存"}},[t._v("浏览器缓存")])]),s("li",[s("a",{attrs:{href:"#基本设置"}},[t._v("基本设置")])]),s("li",[s("a",{attrs:{href:"#正向代理"}},[t._v("正向代理")])]),s("li",[s("a",{attrs:{href:"#负载均衡-反向代理"}},[t._v("负载均衡&& 反向代理")])])])]),s("li",[s("a",{attrs:{href:"#缓存"}},[t._v("缓存")])]),s("li",[s("a",{attrs:{href:"#location"}},[t._v("location")])]),s("li",[s("a",{attrs:{href:"#匹配规则"}},[t._v("匹配规则")])]),s("li",[s("a",{attrs:{href:"#rewrite"}},[t._v("rewrite")]),s("ul",[s("li",[s("a",{attrs:{href:"#表示符"}},[t._v("表示符")])])])]),s("li",[s("a",{attrs:{href:"#核心模块"}},[t._v("核心模块")]),s("ul",[s("li",[s("a",{attrs:{href:"#监控nginx客户端的状态"}},[t._v("监控nginx客户端的状态")])]),s("li",[s("a",{attrs:{href:"#随机主页"}},[t._v("随机主页")])]),s("li",[s("a",{attrs:{href:"#内容替换"}},[t._v("内容替换")])]),s("li",[s("a",{attrs:{href:"#请求连接限制"}},[t._v("请求连接限制")])]),s("li",[s("a",{attrs:{href:"#ab-测试"}},[t._v("ab 测试")])]),s("li",[s("a",{attrs:{href:"#连接限制"}},[t._v("连接限制")])]),s("li",[s("a",{attrs:{href:"#并发请求数限制"}},[t._v("并发请求数限制")])]),s("li",[s("a",{attrs:{href:"#访问控制"}},[t._v("访问控制")])])])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"centos下yum安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#centos下yum安装","aria-hidden":"true"}},[this._v("#")]),this._v(" CentOS下YUM安装")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("vim \n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("yum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repo\n\n写入"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx repo\n    baseurl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("packages"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("centos"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$basearch"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n    gpgcheck"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    enabled"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n运行\n    yum install nginx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("y\n    nginx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"nginx-架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-架构","aria-hidden":"true"}},[this._v("#")]),this._v(" nginx 架构")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("Nginx 采用的是多进程(单线程)和多路IO复用模型")]),this._v(" "),n("li",[this._v("源代码只包含核心模块")]),this._v(" "),n("li",[this._v("其它非核心功能都是通过模块实现，可以自由选择")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"工作流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#工作流程","aria-hidden":"true"}},[this._v("#")]),this._v(" 工作流程")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ul",[s("li",[t._v("1、Nginx 在启动后，会有一个 master 进程和多个相互独立的 worker 进程。")]),t._v(" "),s("li",[t._v("2、接收来自外界的信号,向各worker进程发送信号,每个进程都有可能来处理这个连接。")]),t._v(" "),s("li",[t._v("3、master 进程能监控 worker 进程的运行状态，当 worker 进程退出后(异常情况下)，会自动启动新的 worker 进程。")]),t._v(" "),s("li",[t._v("worker 进程数，一般会设置成机器 cpu 核数。因为更多的worker 数，只会导致进程相互竞争 cpu，从而带来不必要的上下文切换")]),t._v(" "),s("li",[t._v("使用多进程模式，不仅能提高并发率，而且进程之间相互独立，一个 worker 进程挂了不会影响到其他 worker 进程")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"安装目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装目录","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装目录")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("查看nginx安装的配置文件和目录")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("rpm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("-")]),this._v("ql nginx\n")])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("prefix=/etc/nginx //安装目录\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("sbin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path=/usr/sbin/nginx //可执行文件\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("modules"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path=/usr/lib64/nginx/modules //安装模块\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("conf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path=/etc/nginx/nginx.conf  //配置文件路径\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path=/var/log/nginx/error.log  //错误日志\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("log"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path=/var/log/nginx/access.log  //访问日志\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path=/var/run/nginx.pid //进程ID\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("lock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("path=/var/run/nginx.lock //加锁对象\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"日志切割文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日志切割文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 日志切割文件")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("/etc/logrotate.d/nginx")]),this._v(" "),n("li",[this._v("对访问日志进行切割")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("/var/log/nginx/*.log "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    create 0640 nginx root\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每天 切割一份日志")]),t._v("\n    daily\n    rotate 10\n    missingok\n    notifempty\n    compress\n    sharedscripts\n    postrotate\n        /bin/kill "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("USR1 `cat /run/nginx.pid 2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/dev/null` 2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" true\n    endscript\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"日志存放"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日志存放","aria-hidden":"true"}},[this._v("#")]),this._v(" 日志存放")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("默认情况下 日志都存放在 => "),n("code",[this._v("/var/log/nginx")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"日志类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日志类型","aria-hidden":"true"}},[this._v("#")]),this._v(" 日志类型")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("/var/log/nginx/access.log 访问日志")]),this._v(" "),n("li",[this._v("/var/log/nginx/error.log 错误日志")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"内置变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内置变量","aria-hidden":"true"}},[this._v("#")]),this._v(" 内置变量")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("table",[s("thead",[s("tr",[s("th",[t._v("名称")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("$remote_addr")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("客户端地址")])]),t._v(" "),s("tr",[s("td",[t._v("$remote_user")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("客户端用户名称")])]),t._v(" "),s("tr",[s("td",[t._v("$time_local")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("访问时间和时区")])]),t._v(" "),s("tr",[s("td",[t._v("$request")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("请求的URI和HTTP协议")])]),t._v(" "),s("tr",[s("td",[t._v("$http_host")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("请求地址，即浏览器中你输入的地址（IP或域名）")])]),t._v(" "),s("tr",[s("td",[t._v("$status")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("HTTP请求状态")])]),t._v(" "),s("tr",[s("td",[t._v("$body_bytes_sent")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("发送给客户端文件内容大小")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"http请求变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http请求变量","aria-hidden":"true"}},[this._v("#")]),this._v(" HTTP请求变量")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("注意要把-转成下划线,比如User-Agent对应于$http_user_agent\n|名称 |\t含义 |\t例子|\n| ----------- | :----------|\n|arg_PARAMETER |\t请求参数 |\t$arg_name |\n|http_HEADER |\t请求头 |\t$http_referer $http_host $http_user_agent $http_x_forwarded_for(代理过程) |\n|sent_http_HEADER |\t响应头 |\tsent_http_cookie |")]),this._v(" "),n("li",[this._v("IP1->IP2(代理)->IP3 会记录IP地址的代理过程")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("http_x_forwarded_for=Client IP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("Proxy(1) IP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("Proxy(2) IP\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("示例")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义一种日志格式 ")]),t._v("\nlog_format  main  '$remote_addr "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" $remote_user "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$time_local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(' "$request" \'\n                    \'$status $body_bytes_sent "$http_referer" \'\n                    \'"$http_user_agent" "$http_x_forwarded_for"\';\n\nlog_format  zfpx  \'$arg_name $http_referer sent_http_date"\';\n'),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定写入的文件名和日志格式")]),t._v("\naccess_log  /var/log/nginx/access.log  main;   \n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"nginx-命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-命令","aria-hidden":"true"}},[this._v("#")]),this._v(" nginx 命令")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("rpm -ql nginx  查看所有目录")]),this._v(" "),n("li",[this._v("文件配置目录\n"),n("ul",[n("li",[this._v("/etc/nginx/nginx.conf")]),this._v(" "),n("li",[this._v("/etc/nginx/conf.d/*.conf /etc/nginx/conf.d/default.conf")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"值指令继承规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#值指令继承规则","aria-hidden":"true"}},[this._v("#")]),this._v(" 值指令继承规则")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("值指令是向上覆盖的，子配置不存在，可以使用父配置块的指令，如果子指令存在，会覆盖父配置块中的指令")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"主配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主配置文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 主配置文件")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[n("code",[this._v("/etc/nginx/conf.d/default.conf")]),this._v("默认http服务器配置文件")]),this._v(" "),n("li",[n("code",[this._v("/etc/nginx/nginx.conf")]),this._v("核心配置文件")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动nginx 用户")]),t._v("\nuser nginx;\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# work进程数 一般和cpu核数相等")]),t._v("\nworker_processes auto;\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 错误日志路径")]),t._v("\nerror_log /var/log/nginx/error.log;\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进程id写入的文件")]),t._v("\npid /run/nginx.pid;\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.")]),t._v("\ninclude /usr/share/nginx/modules/*.conf;\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 事件模块 和node类似  单进程单线程 事件驱动的  注意制作镜像的时候 events要配置 否则会有问题")]),t._v("\nevents "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 工作进程的 最大链接数 超过这个就不扔掉了")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1024并发量")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个进程允许的最大连接数 10000")]),t._v("\n    worker_connections 1024;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http配置")]),t._v("\nhttp "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义日志的格式")]),t._v("\n    log_format  main  '$remote_addr "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" $remote_user "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$time_local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(' "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n    '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问日志")]),t._v("\n    access_log  /var/log/nginx/access.log  main;\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 打开 零拷贝")]),t._v("\n    sendfile            on;\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后面")]),t._v("\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 保持连接的超时时间")]),t._v("\n    keepalive_timeout   65;\n    types_hash_max_size 4096;\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否启动gzip压缩")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip               on;")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 包含mime文件 根据文件后缀 找服务器的相应头 Content-type")]),t._v("\n    include             /etc/nginx/mime.types;\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认类型 二进制文件")]),t._v("\n    default_type        application/octet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("stream;\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Load modular configuration files from the /etc/nginx/conf.d directory.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# See http://nginx.org/en/docs/ngx_core_module.html#include")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# for more information.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 包含里面的所有文件")]),t._v("\n    include /etc/nginx/conf.d/*.conf;\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# server 配置服务的")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80; \n        listen       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("80;\n        server_name  _;\n        root         /usr/share/nginx/html;\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Load configuration files for the default server block.")]),t._v("\n        include /etc/nginx/default.d/*.conf;\n\n        error_page 404 /404.html;\n        location = /404.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        error_page 500 502 503 504 /50x.html;\n        location = /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"server"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#server","aria-hidden":"true"}},[this._v("#")]),this._v(" server")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[n("code",[this._v("/etc/nginx/conf.d/default.conf")])]),this._v(" "),n("li",[this._v("一个server下面可以配置多个location")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务配置 他是最核心的配置文件")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#监听的端口号")]),t._v("\n    listen       80;  \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#服务名字 后者域名 或者IP")]),t._v("\n    server_name  localhost;  \n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#俄语字符集")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r; ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#访问日志文件和名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  /var/log/nginx/host.access.log  main;")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重点 location是路径的意思 / 匹配所有")]),t._v("\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#静态文件根目录")]),t._v("\n        root   /usr/share/nginx/html;  \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#首页的索引文件")]),t._v("\n        index  index.html index.htm;  \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# = 代表路径全等 不加等号 则匹配前缀 /a/d能匹配到")]),t._v("\n    location = /a "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#静态文件根目录")]),t._v("\n        root   /usr/share/nginx/html;  \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#首页的索引文件")]),t._v("\n        index  index.html index.htm;  \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定错误页面")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_page  404              /404.html;  ")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redirect server error pages to the static page /50x.html")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 把后台错误重定向到静态的50x.html页面")]),t._v("\n    error_page   500 502 503 504  /50x.html; \n    location = /50x.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /usr/share/nginx/html;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"启动和重新加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动和重新加载","aria-hidden":"true"}},[this._v("#")]),this._v(" 启动和重新加载")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("systemctl restart nginx.service")]),this._v(" "),n("li",[this._v("systemctl reload nginx.service")]),this._v(" "),n("li",[this._v("nginx -s reload")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"静态资源服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#静态资源服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 静态资源服务器")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("静态资源：一般客户端发送请求到web服务器，web服务器从内存在取到相应的文件，返回给客户端，客户端解析并渲染显示出来。")]),this._v(" "),n("li",[this._v("动态资源：一般客户端请求的动态资源，先将请求交于web容器，web容器连接数据库，数据库处理数据之后，将内容交给web服务器，web服务器返回给客户端解析渲染处理。")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("浏览器渲染\tHTML、CSS、JS\n图片\tJPEG、GIF、PNG\n视频\tFLV、MPEG\n下载文件\tWord、Excel\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"cdn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cdn","aria-hidden":"true"}},[this._v("#")]),this._v(" CDN")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("CDN的全称是Content Delivery Network，即内容分发网络。")]),this._v(" "),n("li",[this._v("CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。其目的是使用户可就近取得所需内容，解决 Internet网络拥挤的状况，提高用户访问网站的响应速度。")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"语法配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#语法配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 语法配置")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"sendfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sendfile","aria-hidden":"true"}},[this._v("#")]),this._v(" sendfile")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("不经过用户内核发送文件")]),this._v(" "),n("li",[this._v("零拷贝传输模式")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("语法\tsendfile on / off\n默认\tsendfile off;\n上下文\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("location"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("if in location\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"tcp-nopush"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tcp-nopush","aria-hidden":"true"}},[this._v("#")]),this._v(" tcp_nopush")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("在sendfile开启的情况下，合并多个数据包，提高网络包的传输效率")]),this._v(" "),n("li",[this._v("延迟高，合适大文件")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("语法\ttcp_nopush on / off\n默认\ttcp_nopush off;\n上下文\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("location\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"tcp-nodelay"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tcp-nodelay","aria-hidden":"true"}},[this._v("#")]),this._v(" tcp_nodelay")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("在keepalive连接下，提高网络包的传输实时性")]),this._v(" "),n("li",[this._v("实时性,和tcp_nopush相反")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("语法\ttcp_nodelay on / off\n默认\ttcp_nodelay on;\n上下文\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("location\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"gzip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip","aria-hidden":"true"}},[this._v("#")]),this._v(" gzip")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("压缩文件可以节约带宽和提高网络传输效率")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("语法\tgzip on / off\n默认\tgzip off;\n上下文\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n\nlocation / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        index index.html;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开始压缩")]),t._v("\n        gzip on;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果只开启上面  浏览器 拿到的只是一个压缩后的文件")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面开启后 后浏览器才会读取压缩文件 index.html.gz")]),t._v("\n        gzip_static on;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"gzip-comp-level"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip-comp-level","aria-hidden":"true"}},[this._v("#")]),this._v(" gzip_comp_level")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("压缩比率越高，文件被压缩的体积越小")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("语法\tgzip_comp_level level\n默认\tgzip_comp_level 1;\n上下文\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("location\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"gzip-http-version"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gzip-http-version","aria-hidden":"true"}},[this._v("#")]),this._v(" gzip_http_version")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("压缩版本")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("语法\tgzip_http_version 1.0/1.1\n默认\tgzip_http_version 1.1;\n上下文\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("location\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"http-gzip-static-module"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http-gzip-static-module","aria-hidden":"true"}},[this._v("#")]),this._v(" http_gzip-static_module")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("先找磁盘上找同名的.gz这个文件是否存在,节约CPU的压缩时间和性能损耗")]),this._v(" "),n("li",[this._v("http_gzip_static_module 预计gzip模块")]),this._v(" "),n("li",[this._v("http_gunzip_module 应用支持gunzip的压缩方式")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("语法\tgzip_static on/off\n默认\tgzip_static off;\n上下文\thttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(",")]),this._v("location\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"实战"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实战","aria-hidden":"true"}},[this._v("#")]),this._v(" 实战")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"防盗链"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#防盗链","aria-hidden":"true"}},[this._v("#")]),this._v(" 防盗链")])},function(){var t=this.$createElement,n=this._self._c||t;return n("p",[this._v("需要区别哪些请求是非正常的用户请求\n使用"),n("code",[this._v("http_refer")]),this._v("防盗链")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("location ~ .*\\.(jpg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("gif)$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        expires 1h;\n        gzip off;\n        gzip_http_version 1.1;\n        gzip_comp_level 3;\n        gzip_types image/jpeg image/png image/gif;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 直接请求的情况下没有refer")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# none没有写refer blocked非正式HTTP请求 特定IP valid_referers设置ip白名单")]),t._v("\n        valid_referers none blocked 115.29.148.6;\n        if ($invalid_referer) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 验证通过为0，不通过为1")]),t._v("\n            return 403;\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        root /data/images;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("referer       Referer URL (H)\ncurl "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('e "115.29.148.6" http'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//115.29.148.6/kf.jpg\ncurl "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("v "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('e "http'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('//www.baidu.com" http'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//115.29.148.6/kf.jpg\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"跨域"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跨域","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨域")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("跨域是指一个域下的文档或脚本试图去请求另一个域下的资源")]),this._v(" "),n("li",[this._v("默认nginx 不支持使用post 请求 静态文件")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("语法\tadd_header name value\n默认\tadd_header "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(";\n上下文\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n")])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("mkdir "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p /data/json\ncd /data/json\nvi user.json\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('"name"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sg"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation ~ .*\\.json$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     add_header Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Origin http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8080;\n     add_header Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Methods GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("POST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("DELETE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("OPTIONS;\n     root /data/json;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("index.html")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("<"),s("span",{pre:!0,attrs:{class:"token tag"}},[t._v("!DOCTYPE")]),t._v(' HTML PUBLIC "'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('//W3C//DTD HTML 4.0 Transitional//EN"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n<html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n<head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n</head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n<body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n<script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\nlet xhr = new XMLHttpRequest();\n    xhr.open('GET'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://115.29.148.6/user.json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" true);\n    xhr.onreadystatechange = function () "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        if (xhr.readyState == 4 && xhr.status == 200) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            console.log(xhr.responseText);\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nxhr.send();\n</script"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n</body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n</html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"浏览器缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器缓存")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("检验是否过期\tExpires、Cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control(max"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("age)\nEtag\tEtag\nLast"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Modified\tLast"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Modified\n语法\texpires time\n默认\texpires off;\n上下文\thttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n```yaml\nlocation ~ .*\\.(jpg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("gif)$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    expires 24h;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"基本设置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本设置","aria-hidden":"true"}},[this._v("#")]),this._v(" 基本设置")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("table",[s("thead",[s("tr",[s("th",[t._v("语法")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("作用")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("上下文")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("sendfile>on/off")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("不经过用户内核发送文件")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location,if in location")])]),t._v(" "),s("tr",[s("td",[t._v("tcp_nopush>on/off")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在sendfile开启的情况 下，提高网络包的传输效率")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("tcp_nodelay>on/off")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("在keepalive连接下，提高网络包的传输实时性")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("gzip>on/off")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("压缩文件可以节约带宽和提高网络传输效率")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("gzip_comp_level>level")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("压缩比率越高，文件被压缩的体积越小")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("gzip_http_version>1.0/1.1")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("压缩HTTP版本")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("gzip_static>on/off")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("先找磁盘上找同名的.gz这个文件是否存在,节约CPU的压缩时间和性能损耗")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("expires>time")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("添加Cache-Control、Expires头")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("add_header>name value")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("增加请求头")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("http,server,location")])]),t._v(" "),s("tr",[s("td",[t._v("valid_referers>none block\tserver_names")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("使用http_refer防盗链")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("server,location")])])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       80;  //监听的端口号\n    server_name  localhost;  //用域名方式访问的地址\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 图片处理")]),t._v("\n    location ~ .*\\.(jpg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("gif)$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        gzip off; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#关闭压缩")]),t._v("\n        gzip_http_version 1.1;\n        gzip_comp_level 3; \n        gzip_types image/jpeg image/png image/gif;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 浏览器缓存")]),t._v("\n        expires 24h;\n        root /data/images;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面 比上面多了一个防盗链")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 47.104.184.134 服务器id")]),t._v("\n    location ~ .*\\.(jpg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("gif)$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        expires 1h;\n        gzip off;\n        gzip_http_version 1.1;\n        gzip_comp_level 3;\n        gzip_types image/jpeg image/png image/gif;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# valid_referers 防盗链")]),t._v("\n        valid_referers none blocked 47.104.184.134;\n        if ($invalid_referer) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           return 403;\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        root /data/images;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# html等代码处理")]),t._v("\n    location ~ .*\\.(html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("css)$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        gzip_static on;\n        gzip on; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用压缩")]),t._v("\n        gzip_min_length 1k;    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#只压缩超过1K的文件")]),t._v("\n        gzip_http_version 1.1; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用gzip压缩所需的HTTP最低版本")]),t._v("\n        gzip_comp_level 9;     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#压缩级别，压缩比率越高文件被压缩的体积越小")]),t._v("\n        gzip_types  text/css application/javascript; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#进行压缩的文件类型")]),t._v("\n        root /data/www/html;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载")]),t._v("\n    location ~ ^/download "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        gzip_static on; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启用压缩")]),t._v("\n        tcp_nopush on;  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不要着急发，攒一波再发")]),t._v("\n        root /data/www; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 注意此处目录是`/data/www`而不是`/data/www/download`")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 跨域")]),t._v("\n    location ~ .*\\.json$ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        add_header Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Origin http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("3000;\n        add_header Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Methods GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("POST"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("PUT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("DELETE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("OPTIONS;\n        add_header Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Headers Content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Type;\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#允许携带凭证 ")]),t._v("\n        add_header Access"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Allow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Credentials true;\n        root /data/json;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置跨域的demo")]),t._v("\n\n    let xhr = new XMLHttpRequest();\n        xhr.open('GET'"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://47.104.184.134/users.json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" true);\n        xhr.onreadystatechange = function () "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            if (xhr.readyState == 4 && xhr.status == 200) "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                console.log(xhr.responseText);\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    xhr.send();\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"正向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#正向代理","aria-hidden":"true"}},[this._v("#")]),this._v(" 正向代理")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("正向代理的对象是客户端,服务器端看不到真正的客户端")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("resolver 8.8.8.8; "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#谷歌的域名解析地址")]),t._v("\nlocation / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $http_host 要访问的主机名 $request_uri请求路径")]),t._v("\n    proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//$http_host$request_uri;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"负载均衡-反向代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡-反向代理","aria-hidden":"true"}},[this._v("#")]),this._v(" 负载均衡&& 反向代理")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("反向代理的对象的服务端,客户端看不到真正的服务端\n| 语法 | 作用|上下文|\n| ----------- | :----------: | :----------|\n|proxy_pass>URL|代理服务|server,location|\n|upstream>name {}|负载均衡|http|")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[t._v("负载均衡分配方式")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("方法")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("轮询（默认）")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器down掉，能自动剔除。")])]),t._v(" "),s("tr",[s("td",[t._v("weight(加权轮询)")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。")])]),t._v(" "),s("tr",[s("td",[t._v("ip_hash")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("每个请求按访问ip的hash结果分配，这样每个访客固定访问一个后端服务器，可以解决session的问题。")])]),t._v(" "),s("tr",[s("td",[t._v("url_hash（第三方）")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("按访问的URL地址来分配 请求，每个URL都定向到同一个后端 服务器上(缓存)")])]),t._v(" "),s("tr",[s("td",[t._v("fair（第三方）")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("按后端服务器的响应时间来分配请求，响应时间短的优先分配。")])]),t._v(" "),s("tr",[s("td",[t._v("least_conn")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("最小连接数，哪个连接少就分给谁")])]),t._v(" "),s("tr",[s("td",[t._v("自定义hash")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("hash自定义key")])])])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("upstream zfpx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ip_hash"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//监听的端口号")]),t._v("\n    server_name  localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//用域名方式访问的地址")]),t._v("\n    # 反向代理\n    resolver "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8.8")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".8")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name locahost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    # 负载均衡\n    location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zfpx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缓存","aria-hidden":"true"}},[this._v("#")]),this._v(" 缓存")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("proxy_cache")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    proxy_cache_path /data/nginx/tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test levels=1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2 keys_zone=tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("100m inactive=7d max_size=1000g;  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy_cache_path 缓存文件路径\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" levels 设置缓存文件目录层次；levels=1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2 表示两级目录\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" keys_zone 设置缓存名字和共享内存大小\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" inactive 在指定时间内没人访问则被删除\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" max_size 最大缓存空间，如果缓存空间满，默认覆盖掉缓存时间最长的资源。\n\nlocation /tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n  proxy_cache tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test;  \n  proxy_cache_valid  200 206 304 301 302 10d;  \n  proxy_cache_key $uri;  \n  proxy_set_header Host $host"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$server_port;  \n  proxy_set_header X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Real"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("IP $remote_addr;  \n  proxy_set_header   X"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Forwarded"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("For $proxy_add_x_forwarded_for;  \n  proxy_pass http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8081/media_store.php/tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test/;  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy_cache tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test 使用名为tmp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("test的对应缓存配置\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy_cache_valid 200 206 304 301 302 10d; 对httpcode为200…的缓存10天\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy_cache_key $uri 定义缓存唯一key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("通过唯一key来进行hash存取\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy_set_header 自定义http header头，用于发送给后端真实服务器。\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" proxy_pass 指代理后转发的路径，注意是否需要最后的/\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"location"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#location","aria-hidden":"true"}},[this._v("#")]),this._v(" location")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("正则表达式")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("类型\t种类\n.\t匹配除换行符之外的任意字符\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v("\t重复0次或1次\n+\t重复1次或更多次\n*\t重复零次或多次\n^\t匹配字符串的开始\n$\t匹配字符串的结束\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t重复n次\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\t重复n次或更多次\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("abc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\t匹配单个字符a或者b或者c\na"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("z\t匹配a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("z小写字母的任意一个\n\\\t转义字符\n()\t用于匹配括号之间的内容，可以通过$1、$2引用\n\\w\t的释义都是指包含大 小写字母数字和下划线 相当于("),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("9a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("zA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(")\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"匹配规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#匹配规则","aria-hidden":"true"}},[this._v("#")]),this._v(" 匹配规则")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("等号类型（=）的优先级最高。一旦匹配成功，则不再查找其他匹配项。")]),this._v(" "),n("li",[this._v("^~类型表达式。一旦匹配成功，则不再查找其他匹配项。")]),this._v(" "),n("li",[this._v("正则表达式类型（~ ~*）的优先级次之。如果有多个location的正则能匹配的话，则使用正则表达式最长的那个。")]),this._v(" "),n("li",[this._v("常规字符串匹配类型按前缀匹配")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"rewrite"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rewrite","aria-hidden":"true"}},[this._v("#")]),this._v(" rewrite")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("实现ur的重写以及重定向")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# rewrite 他会 匹配 ^(.*)$ => 满足所有正则 返回 => /usr/share/nginx/html + /test.html ")]),this._v("\nroot /usr/share/nginx/html;\n\nlocation /test "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("{")]),this._v("\n        rewrite ^(.*)$ /test.html break;\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("}")]),this._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"表示符"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表示符","aria-hidden":"true"}},[this._v("#")]),this._v(" 表示符")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ul",[s("li",[t._v("last\n"),s("ul",[s("li",[t._v("先匹配自己的location,然后通过rewrite规则新建一个请求再次请求服务端,做了一个内部跳转")]),t._v(" "),s("li",[t._v("结束当前的请求处理,用替换后的URI重新匹配location")]),t._v(" "),s("li",[t._v("可理解为重写（rewrite）后，发起了一个新请求，进入server模块，匹配location")]),t._v(" "),s("li",[t._v("如果重新匹配循环的次数超过10次，nginx会返回500错误")]),t._v(" "),s("li",[t._v("返回302 http状态码")]),t._v(" "),s("li",[t._v("浏览器地址栏显示重定向后的url")])])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("location ~ ^/last "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rewrite ^/last /test last;\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nlocation /test "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      default_type application/json;\n      return 200 '"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('"code"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('"msg"'),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"success"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("';\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("break\n"),n("ul",[n("li",[this._v("先匹配自己的location,然后生命周期会在当前的location结束,不再进行后续的匹配")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("location ~ ^/break "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("{")]),this._v("\n    rewrite ^/break /test break;\n    root /data/html;\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("}")]),this._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("redirect\n"),n("ul",[n("li",[this._v("返回302昨时重定向,以后还会请求这个服务器")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("location ~ ^/permanent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("{")]),this._v("\n rewrite ^/permanent http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(":")]),this._v("//www.baidu.com permanent;\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("}")]),this._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("permanent\n"),n("ul",[n("li",[this._v("返回301永久重定向,以后会直接请求永久重定向后的域名")])])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language-yaml extra-class"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[this._v("location ~ ^/redirect "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("{")]),this._v("\n rewrite ^/redirect http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(":")]),this._v("//www.baidu.com redirect;\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("}")]),this._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"核心模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心模块","aria-hidden":"true"}},[this._v("#")]),this._v(" 核心模块")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"监控nginx客户端的状态"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#监控nginx客户端的状态","aria-hidden":"true"}},[this._v("#")]),this._v(" 监控nginx客户端的状态")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("--with-http_stub_status_module 监控nginx客户端的状态")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 语法")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" stub_status on/off;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("location\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80;\n        server_name  localhost;\n        location = /status "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                stub_status on;\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("nagios 开源的监听系统, 可以监听服务的状态")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("systemctl reload nginx.service\n\nhttp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//192.171.207.104/status\n\nActive connections"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2            ")]),t._v("\nserver accepts handled requests  \n 3 3 10 \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Reading")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0 Writing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1 Waiting"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1 ")]),t._v("\n\n参数\t含义\nActive connections\t当前nginx正在处理的活动连接数\naccepts\t总共处理的连接数\nhandled\t成功创建握手数\nrequests\t总共处理请求数\nReading\t读取到客户端的Header信息数\nWriting\t返回给客户端的Header信息数\nWaiting\t开启keep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alive的情况下"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("这个值等于 active – (reading + writing)\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"随机主页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#随机主页","aria-hidden":"true"}},[this._v("#")]),this._v(" 随机主页")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("--with-http_random_index_module 在根目录里随机选择一个主页显示")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" random_index on/off;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("location\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        listen       80;\n        server_name  localhost;\n        location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            root /usr/share/nginx/html;\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 他会在root 目录下随机 返回一个")]),t._v("\n            random_index on ;\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#index index.html index.htm")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"内容替换"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内容替换","aria-hidden":"true"}},[this._v("#")]),this._v(" 内容替换")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("--with-http_sub_module 内容替换")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" sub_filter string replacement;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n\nlocation / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root   /usr/share/nginx/html;\n    index  index.html index.htm;\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 他会把啊 文件里面的name 全部替换成sg")]),t._v("\n    sub_filter 'name' 'sg';\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"请求连接限制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求连接限制","aria-hidden":"true"}},[this._v("#")]),this._v(" 请求连接限制")])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ul",[s("li",[t._v("--with-limit_conn_module 连接频率限制")]),t._v(" "),s("li",[t._v("--with-limit_req_module 请求频率限制")]),t._v(" "),s("li",[t._v("一次TCP请求至少产生一个HTTP请求")]),t._v(" "),s("li",[t._v("SYN > SYN,ACK->ACK->REQUEST->RESPONSE->FIN->ACK->FIN->ACK")]),t._v(" "),s("li",[t._v("三次握手 四次挥手 本质是在一个不可靠的通信世界建立可靠的链接")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"ab-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ab-测试","aria-hidden":"true"}},[this._v("#")]),this._v(" ab 测试")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("Apache的ab命令模拟多线程并发请求，测试服务器负载压力，也可以测试nginx、lighthttp、IIS等其它Web服务器的压力")]),this._v(" "),n("li",[this._v("-n 总共的请求数")]),this._v(" "),n("li",[this._v("-c 并发的请求数")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("yum "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("y install httpd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("tools\nab "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("n 40 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("c 20 http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1/\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"连接限制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#连接限制","aria-hidden":"true"}},[this._v("#")]),this._v(" 连接限制")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("--ngx_http_limit_conn_module 模块会在NGX_HTTP_PREACCESS_PHASE阶段生效")]),this._v(" "),n("li",[this._v("针对全部的worker生效，依赖realip模块获得到的真实IP")]),this._v(" "),n("li",[this._v("limit_conn_zone 定义共享内存(大小)，以及key关键字")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以 以IP为key zone为空间的名称 size为申请空间的大小")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_conn_zone key zone=name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("size;   \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http(定义在server以外)\n")])])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zone名称 number限制的数量")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_conn  zone number;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_conn_log_level  info"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("notice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("warn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("error;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_conn_log_level error;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_conn_status  code;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_conn_status 503;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 案例")]),t._v("\nlimit_conn_zone $binary_remote_addr zone=conn_zone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10m;\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  location /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      root   /usr/share/nginx/html;  \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#首页的索引文件")]),t._v("\n      index  index.html index.htm;  \n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 失败 返回的状态码  默认是503")]),t._v("\n      limit_conn_status 500;\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 日志级别是 warn")]),t._v("\n      limit_conn_log_level warn;\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每秒最多返回50字节 注意这个 会卡")]),t._v("\n      limit_rate 50;\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 并发连接数最多是1")]),t._v("\n      limit_conn conn_zone 1;\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"并发请求数限制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#并发请求数限制","aria-hidden":"true"}},[this._v("#")]),this._v(" 并发请求数限制")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("ngx_http_limit_req_module模块是在NGX_HTTP_PREACCESS_PHASE阶段生效")]),this._v(" "),n("li",[this._v("生效算法是漏斗算法(Leaky Bucket) 把突出的流量限定为每秒恒定多少个请求")]),this._v(" "),n("li",[this._v("Traffic Shaping的核心理念是等待，Traffic Policing的核心理念是丢弃")]),this._v(" "),n("li",[this._v("limit_req生效是在limit_conn之前的")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以以IP为key zone为空间的名称 size为申请空间的大小")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_req_zone key zone=name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("size rate=rate;   \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http(定义在server以外)\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("limit_req_zone 定义共享内存，以及key和限制速度")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zone名称 number限制的数量")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" limit_req  zone=name "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("burst=number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nodelay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(";\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 案例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# zone=req_zone:10m 共享大小10m rate=1r/s 速率每秒1个")]),t._v("\nlimit_req_zone $binary_remote_addr zone=req_zone"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("10m rate=1r/s;\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      root   /usr/share/nginx/html;\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#首页的索引文件")]),t._v("\n      index  index.html index.htm;\n      limit_req zone=req_zone;\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# burst 表示缓存为5 ")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 即每秒最多可处理rate+burst个.同时处理rate个")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果有burst的情况 会有延迟 ")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ab -n 20 -c 4 http://127.0.0.1/ 一起发送20个 每次并发4")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如果nodelay 不做延迟 他会将 burst+rate 一起处理(3+1)个 但是后面3秒内都会处理请求 在5秒开始 失败的次数和rate 有关系")]),t._v("\n      limit_req zone=one burst=3 nodelay;\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"访问控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问控制","aria-hidden":"true"}},[this._v("#")]),this._v(" 访问控制")])},function(){var t=this.$createElement,n=this._self._c||t;return n("ul",[n("li",[this._v("基于IP的访问控制 -http_access_module")])])},function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" allow address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("all;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("limit_except\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Syntax")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deny address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("CIDR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("all;\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("limit_except\n\nserver "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n location ~ ^/admin.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拒绝")]),t._v("\n      deny 192.171.207.100;\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许")]),t._v("\n      allow all;\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])}],!1,null,null,null);n.default=e.exports}}]);