<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>node | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/Study-history/assets/css/0.styles.e2241fa8.css" as="style"><link rel="preload" href="/Study-history/assets/js/app.a1ad6491.js" as="script"><link rel="preload" href="/Study-history/assets/js/48.d5004b5b.js" as="script"><link rel="prefetch" href="/Study-history/assets/js/10.7e604d29.js"><link rel="prefetch" href="/Study-history/assets/js/11.3067a7ca.js"><link rel="prefetch" href="/Study-history/assets/js/12.d1a6fe69.js"><link rel="prefetch" href="/Study-history/assets/js/13.4864be39.js"><link rel="prefetch" href="/Study-history/assets/js/14.30636de0.js"><link rel="prefetch" href="/Study-history/assets/js/15.2bcbbae8.js"><link rel="prefetch" href="/Study-history/assets/js/16.9d7f8d82.js"><link rel="prefetch" href="/Study-history/assets/js/17.0b328dfe.js"><link rel="prefetch" href="/Study-history/assets/js/18.f73ae9e0.js"><link rel="prefetch" href="/Study-history/assets/js/19.0e9a993e.js"><link rel="prefetch" href="/Study-history/assets/js/2.d8f505d4.js"><link rel="prefetch" href="/Study-history/assets/js/20.1a0bbb82.js"><link rel="prefetch" href="/Study-history/assets/js/21.23696e8c.js"><link rel="prefetch" href="/Study-history/assets/js/22.0c73380e.js"><link rel="prefetch" href="/Study-history/assets/js/23.c3ff09bc.js"><link rel="prefetch" href="/Study-history/assets/js/24.7933ac39.js"><link rel="prefetch" href="/Study-history/assets/js/25.c8ae28e2.js"><link rel="prefetch" href="/Study-history/assets/js/26.3736bb12.js"><link rel="prefetch" href="/Study-history/assets/js/27.97f3f560.js"><link rel="prefetch" href="/Study-history/assets/js/28.fa4268d5.js"><link rel="prefetch" href="/Study-history/assets/js/29.50a00a75.js"><link rel="prefetch" href="/Study-history/assets/js/3.8796f9d7.js"><link rel="prefetch" href="/Study-history/assets/js/30.25371944.js"><link rel="prefetch" href="/Study-history/assets/js/31.b1b8fd04.js"><link rel="prefetch" href="/Study-history/assets/js/32.f534b2b4.js"><link rel="prefetch" href="/Study-history/assets/js/33.b9e3298a.js"><link rel="prefetch" href="/Study-history/assets/js/34.8ac7105e.js"><link rel="prefetch" href="/Study-history/assets/js/35.ba4dfc73.js"><link rel="prefetch" href="/Study-history/assets/js/36.ef19edf1.js"><link rel="prefetch" href="/Study-history/assets/js/37.0f9caf07.js"><link rel="prefetch" href="/Study-history/assets/js/38.2e4a8c9a.js"><link rel="prefetch" href="/Study-history/assets/js/39.46f87030.js"><link rel="prefetch" href="/Study-history/assets/js/4.c59777f9.js"><link rel="prefetch" href="/Study-history/assets/js/40.e1794eae.js"><link rel="prefetch" href="/Study-history/assets/js/41.5507fc07.js"><link rel="prefetch" href="/Study-history/assets/js/42.caa5814b.js"><link rel="prefetch" href="/Study-history/assets/js/43.6cd8bb3f.js"><link rel="prefetch" href="/Study-history/assets/js/44.2442f75f.js"><link rel="prefetch" href="/Study-history/assets/js/45.9648c0bd.js"><link rel="prefetch" href="/Study-history/assets/js/46.de6e3a74.js"><link rel="prefetch" href="/Study-history/assets/js/47.72c2c6ba.js"><link rel="prefetch" href="/Study-history/assets/js/49.a2d1d664.js"><link rel="prefetch" href="/Study-history/assets/js/5.9b395665.js"><link rel="prefetch" href="/Study-history/assets/js/50.19b7d6c9.js"><link rel="prefetch" href="/Study-history/assets/js/51.a9a0da08.js"><link rel="prefetch" href="/Study-history/assets/js/52.e99771cc.js"><link rel="prefetch" href="/Study-history/assets/js/53.74e55a43.js"><link rel="prefetch" href="/Study-history/assets/js/54.c4ff7ebc.js"><link rel="prefetch" href="/Study-history/assets/js/55.acadfba7.js"><link rel="prefetch" href="/Study-history/assets/js/56.8fa49260.js"><link rel="prefetch" href="/Study-history/assets/js/57.08f5f4e4.js"><link rel="prefetch" href="/Study-history/assets/js/58.9d13dd4c.js"><link rel="prefetch" href="/Study-history/assets/js/6.d5fd31a3.js"><link rel="prefetch" href="/Study-history/assets/js/7.ec2eb6b8.js"><link rel="prefetch" href="/Study-history/assets/js/8.91dd34c9.js"><link rel="prefetch" href="/Study-history/assets/js/9.814e5587.js">
    <link rel="stylesheet" href="/Study-history/assets/css/0.styles.e2241fa8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Study-history/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Study-history/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/Study-history/houduan/" class="nav-link router-link-active">back</a></div><div class="nav-item"><a href="/Study-history/devOps/" class="nav-link">devOps</a></div><div class="nav-item"><a href="/Study-history/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/Study-history/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/songge7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Study-history/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/Study-history/houduan/" class="nav-link router-link-active">back</a></div><div class="nav-item"><a href="/Study-history/devOps/" class="nav-link">devOps</a></div><div class="nav-item"><a href="/Study-history/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/Study-history/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/songge7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>houduan</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Study-history/houduan/node.html" class="active sidebar-link">node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#fs-有sync是同步-无是异步" class="sidebar-link">fs(有Sync是同步  无是异步)</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#path" class="sidebar-link">path</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#process" class="sidebar-link">process</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#url" class="sidebar-link">url</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#vm" class="sidebar-link">vm</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#buffer" class="sidebar-link">buffer</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#events" class="sidebar-link">events</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#util" class="sidebar-link">util</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#stream" class="sidebar-link">stream</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#http" class="sidebar-link">http</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#后端接受的数据" class="sidebar-link">后端接受的数据</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/node.html#常用的库" class="sidebar-link">常用的库</a></li></ul></li><li><a href="/Study-history/houduan/ios.html" class="sidebar-link">ISO</a></li><li><a href="/Study-history/houduan/mongodb.html" class="sidebar-link">MongoDB</a></li><li><a href="/Study-history/houduan/mock.html" class="sidebar-link">Mockjs</a></li><li><a href="/Study-history/houduan/koa.html" class="sidebar-link">koa原理</a></li><li><a href="/Study-history/houduan/http.html" class="sidebar-link">http</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="node"><a href="#node" aria-hidden="true" class="header-anchor">#</a> node</h1> <p></p><div class="table-of-contents"><ul><li><a href="#fs-有sync是同步-无是异步">fs(有Sync是同步  无是异步)</a></li><li><a href="#path">path</a></li><li><a href="#process">process</a></li><li><a href="#url">url</a></li><li><a href="#vm">vm</a></li><li><a href="#buffer">buffer</a></li><li><a href="#events">events</a></li><li><a href="#util">util</a></li><li><a href="#stream">stream</a></li><li><a href="#http">http</a></li><li><a href="#后端接受的数据">后端接受的数据</a><ul><li><a href="#客户端">客户端</a></li></ul></li><li><a href="#常用的库">常用的库</a></li></ul></div><p></p> <h2 id="fs-有sync是同步-无是异步"><a href="#fs-有sync是同步-无是异步" aria-hidden="true" class="header-anchor">#</a> fs(有Sync是同步  无是异步)</h2> <p><strong>1、fs.access('文件夹名字') 判断文件夹是否存在   fs.existsSync(path) 判断文件是否存在</strong></p> <p><strong>2、fs.readdir('m') 读取根文件下的 m文件下面的文件 返回一个数组 没有则是空数组</strong></p> <p><strong>3、let r = fs.stat('m') 读取根文件下的 m文件的状态</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  r<span class="token punctuation">.</span>size 文件的大小
  r<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 判断文件是不是目录
  r<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 判断文件是不是文件
</code></pre></div><p><strong>4、fs.rmdir('m') 删除m目录fs.unlink('m') 删除m文件</strong></p> <p><strong>5、fs.open('text.js','r',(err,fdr)=&gt;{}) 打开文件</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>      <span class="token comment">//'r' 做什么  flag:'r'/'w'			</span>
      <span class="token comment">//回调  fdr 打开文件的标示 是一个数字</span>
    fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fdr<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bufLength<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>bytesRead<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">//fdr 			打开文件 的一个标示</span>
      <span class="token comment">//buf 			临时存储的一个流空间</span>
      <span class="token comment">//0   			读取buf的开始位子</span>
      <span class="token comment">//bufLength 读取buf的长度</span>
      <span class="token comment">//null      文件开始读取的位子</span>
      <span class="token comment">//回调      bytesRead参数是 实际读取的字节数</span>
    fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fdr<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>bufLength<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//参数同上</span>
    fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fdr<span class="token punctuation">)</span>
</code></pre></div><p><strong>6、fs读/写</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  异步读取</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token comment">/*
  options
    encoding
    flag flag 默认 = 'r'
  fs.readFile('1.js','utf8',(err,item)=&gt;{
    console.log('item',item)
  })
*/</span>
<span class="token comment">// 同步读取</span>
fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 异步写入</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token comment">/*
  options
    encoding
    flag flag 默认 = 'w'
    mode 读写权限，默认为0666

  let fs = require('fs');
  fs.writeFile('./1.txt',Date.now()+'\n',{flag:'a'},function(){
    console.log('ok');
  });
*/</span>
<span class="token comment">// 同步写入</span>
fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">// 追加文件</span>
fs<span class="token punctuation">.</span><span class="token function">appendFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
<span class="token comment">/*
  fs.appendFile('./1.txt',Date.now()+'\n',function(){
    console.log('ok');
  })
*/</span>
<span class="token comment">// 拷贝文件</span>
<span class="token keyword">function</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token parameter">src<span class="token punctuation">,</span>target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="path"><a href="#path" aria-hidden="true" class="header-anchor">#</a> path</h2> <p><strong>1、__dirname表示的是当前的文件所在的文件夹</strong></p> <p><strong>2、path.resolve(__dirname,'test.js')   这两个都一样 用来拼接地址</strong></p> <p><strong>3、path.join(__dirname ,'test.js')</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  path<span class="token punctuation">.</span>resolve和path<span class="token punctuation">.</span><span class="token function">join区别</span><span class="token punctuation">(</span>第二个参数是否带<span class="token operator">/</span><span class="token punctuation">)</span>
  path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/index.html'</span><span class="token punctuation">)</span> <span class="token comment">//e:\index.html</span>
  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'/index.html'</span><span class="token punctuation">)</span> <span class="token comment">//e:\study\node\index.html</span>
</code></pre></div><p><strong>4、path.extname(1123.js)               输出.js(找后缀)</strong></p> <p><strong>5、path.basename('1.min.js','.js')     输出1.min(通过后缀 找文件路径)</strong></p> <p><strong>6、path.relative 从绝对路径里面找相对路径</strong></p> <p><strong>7、path.posix 为了保证在不同的操作系统下唯一性</strong></p> <ul><li><code>let {join,dirname} = require('path').posix</code>不同操作系统分割符不一样</li></ul> <p>**7、path.dirname 找父路径  path.dirname('./src/a.js') =&gt;./src **</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 当前在c:/index/a/b/c 知道c:/index  获取/a/b/c</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>c<span class="token punctuation">:</span><span class="token operator">/</span>index<span class="token punctuation">,</span>c<span class="token punctuation">:</span><span class="token operator">/</span>index<span class="token operator">/</span>a<span class="token operator">/</span>b<span class="token operator">/</span>c<span class="token punctuation">)</span>
<span class="token comment">// c == a/b/c  主要a前面没有/</span>
</code></pre></div><h2 id="process"><a href="#process" aria-hidden="true" class="header-anchor">#</a> process</h2> <p><strong>1、process.pid       node进程</strong></p> <p><strong>2、process.exit()    停止当前进程(node中断)</strong></p> <p><strong>3、process.cwd()     查找当前绝对定位的目录(vscode当前打开的文件夹和git当前文件)</strong></p> <p><strong>4、process.chdir()   改变工作目录</strong></p> <p><strong>5、process.nextTick  异步跟promise差不多(里面不能递归)</strong></p> <p><strong>6、process.env.NODE_ENV  暂时不会</strong></p> <p><strong>7、process.argv      暂时不会</strong></p> <p><strong>8、process.stdin标准输入 是一个可读流  在控制台上操作</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  process<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span> <span class="token comment">//在控制台输入123</span>
   <span class="token comment">// 0d 0a  代表换行 回撤</span>
</code></pre></div><p><strong>9、process.stdout标准输出 是一个可写  将内容输出到控制台</strong></p> <h2 id="url"><a href="#url" aria-hidden="true" class="header-anchor">#</a> url</h2> <p><strong>url 模块下的parse(url,boolean) 能解析 url  boolean为true时 取到的query是一个对象(?后面的)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token punctuation">{</span>pathname<span class="token punctuation">,</span>query<span class="token punctuation">}</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com:8080/s?a==1'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span>query<span class="token punctuation">)</span> <span class="token comment">// /s { a: '=1' }</span>
</code></pre></div><h2 id="vm"><a href="#vm" aria-hidden="true" class="header-anchor">#</a> vm</h2> <p><strong>vm.runInThisContext(fn)  沙箱 fn放在一个独立的虚拟环境中(在require源码会用到)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token template-string"><span class="token string">`(function a(){let b = 1;console.log('b2',b)})()`</span></span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
</code></pre></div><h2 id="buffer"><a href="#buffer" aria-hidden="true" class="header-anchor">#</a> buffer</h2> <ul><li>声明</li></ul> <p><strong>1、Buffer.alloc('12') 通过数组声明</strong></p> <p><strong>2、Buffer.from('我')  通过存放数组或者字符</strong></p> <ul><li>方法 (跟数组类似,没有分割split)</li></ul> <p><strong>1、slice(是同组数都是浅拷贝 拷贝的是引用地址)</strong></p> <p><strong>2、forEach</strong></p> <p><strong>3、copy</strong></p> <p><strong>4、concat(同数组)</strong></p> <p><strong>5、indexOf(同数组)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">//concat用法</span>
    <span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a1<span class="token punctuation">,</span>a2<span class="token punctuation">,</span>a3<span class="token punctuation">]</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
      <span class="token function">例子</span><span class="token punctuation">(</span>a1等代表的是Buffer<span class="token punctuation">,</span>n代表的是截取多少字节<span class="token punctuation">,</span>不写就是全部<span class="token punctuation">)</span>
      <span class="token keyword">let</span> a1 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'我'</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> a2 <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'ni'</span><span class="token punctuation">)</span>
      <span class="token keyword">let</span> r <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a1<span class="token punctuation">,</span>a2<span class="token punctuation">]</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
  <span class="token comment">//重写split方法</span>
  <span class="token class-name">Buffer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">split</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> buf <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span>length
    <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">!=</span> index<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span>index<span class="token punctuation">)</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
      offset <span class="token operator">=</span> len <span class="token operator">+</span> index
      index <span class="token operator">=</span> buf<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>offset<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="events"><a href="#events" aria-hidden="true" class="header-anchor">#</a> events</h2> <p><strong>1、on('事件','函数')				监听</strong></p> <p><strong>2、on('newListener','函数')    	监听 用户绑定的事件</strong></p> <p><strong>3、once('事件','函数')    			监听一次</strong></p> <p><strong>4、emit('事件')    				发布</strong></p> <p><strong>5、prependListener('事件','函数')   插队到最前面</strong></p> <p><strong>6、off('事件','函数')           	 删除</strong></p> <p><strong>7、defaultMaxListeners      		事件总数</strong></p> <h2 id="util"><a href="#util" aria-hidden="true" class="header-anchor">#</a> util</h2> <p><strong>1、util.inherits(girl类,people类) girl继承people原型上的方法</strong></p> <p><strong>继承原型上的属性 公有属性(私有的不会继承)</strong></p> <p><strong>2、n.call(obj,参数1) fn是方法 obj是对象(继承私有的)</strong></p> <p><strong>3、stat = util.promisify(fs.stat) 将fs.stat方法包装成 promise 只能一个个添加 对应的还有一个mz</strong></p> <p><strong>4、let fs = require('mz/fs') mz需要引入 mz将fs所有的方法转换成promise</strong></p> <h2 id="stream"><a href="#stream" aria-hidden="true" class="header-anchor">#</a> stream</h2> <p><strong>流:</strong> 并不关系整体文件大小</p> <p><strong>分类:</strong> 可读、可写、转换、双工流</p> <ul><li>转换流和双工流 相同点:都是可读可写, 不同点:转换流 读写的流是相同的,双工流读写不一样</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token comment">//读流</span>
  <span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'./a.md'</span><span class="token punctuation">,</span>options<span class="token punctuation">)</span>
    <span class="token function">options</span><span class="token punctuation">(</span>对象<span class="token punctuation">)</span>
      flags<span class="token punctuation">:</span><span class="token string">'r'</span><span class="token punctuation">,</span>
      encoding<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
      autoClose<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
      start<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
      end<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// 包前又包后</span>
      highWaterMark<span class="token punctuation">:</span><span class="token number">3</span> <span class="token comment">//默认64K 每次读取64k</span>
      <span class="token comment">//默认情况下 非流动模式 如果监听了on('data')事件 就变成流动模式 </span>
      <span class="token comment">//不停的读取文件 将文件读取完毕(最快的速度),之后触发on('end')事件</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'resume'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'pause'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      rs<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//写流</span>
  <span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span>options<span class="token punctuation">)</span>
      <span class="token function">options</span><span class="token punctuation">(</span>对象<span class="token punctuation">)</span>
        flags<span class="token punctuation">:</span> <span class="token string">'w'</span><span class="token punctuation">,</span>
        encoding<span class="token punctuation">:</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>
        autoClose<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        highWaterMark<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">//默认16K 不是代表的每次能写16k  预计我用16k来写</span>
      ws<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drain'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//drain 只有当我们写入的内容大于我们的预期，并且被清空后才会触发事件</span>
  <span class="token comment">//pipe 边读边写</span>
  <span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> rs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'1.txt'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    highWaterMark<span class="token punctuation">:</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> ws <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">'2.txt'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    highWaterMark<span class="token punctuation">:</span><span class="token number">4</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//边读边写</span>
  rs<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>ws<span class="token punctuation">)</span>
  <span class="token comment">// 双工流</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>Duplex<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inoutStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Duplex</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function">write</span><span class="token punctuation">(</span><span class="token parameter">chunk<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  inoutStream<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  process<span class="token punctuation">.</span>stdin<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>inoutStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="http"><a href="#http" aria-hidden="true" class="header-anchor">#</a> http</h2> <p>http版本1.1</p> <p><strong>长连接</strong>
每次请求的时候不会重新创建新的通道,会复用原来的通道</p> <p><strong>管线化</strong>
数据并发(多个请求)
<strong>url和uri</strong></p> <ul><li>URI:统一资源标识符</li> <li>URL:统一资源定位符</li> <li>URN:统一资源命名符</li></ul> <p><strong>URL的格式</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>user<span class="token punctuation">:</span>pass@www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>jp<span class="token punctuation">:</span><span class="token number">80</span><span class="token operator">/</span>dir<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">?</span>uid<span class="token operator">=</span><span class="token number">1</span>#ch1
    http            协议方案名
    user<span class="token punctuation">:</span>pass       <span class="token function">登陆信息</span><span class="token punctuation">(</span>认证<span class="token punctuation">)</span>
    www<span class="token punctuation">.</span>example<span class="token punctuation">.</span>jp  服务器地址
    <span class="token number">80</span>              端口
    dir<span class="token operator">/</span>index<span class="token punctuation">.</span>html  带层次的文件路径
    uid             查询字符串
    ch1             <span class="token function">片段标识符</span><span class="token punctuation">(</span>后端拿不到这个值<span class="token punctuation">)</span>    
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>  常用状态码<span class="token punctuation">:</span>
    <span class="token number">1</span><span class="token function">XX</span><span class="token punctuation">(</span>信息状态码 websocket才用<span class="token punctuation">)</span>
    <span class="token number">2</span><span class="token function">XX</span><span class="token punctuation">(</span>Success 成功状态码<span class="token punctuation">)</span>
      <span class="token number">200</span><span class="token punctuation">:</span>正常返回
      <span class="token number">204</span><span class="token punctuation">:</span>返回的结果只有请求头 没有响应体
      <span class="token number">206</span><span class="token punctuation">:</span>分段传输
    <span class="token number">3</span><span class="token function">XX</span><span class="token punctuation">(</span>Redirection 重定向<span class="token punctuation">)</span>
      <span class="token number">301</span><span class="token punctuation">:</span>永久重定向
      <span class="token number">302</span><span class="token punctuation">:</span>临时重定向
      <span class="token number">304</span><span class="token punctuation">:</span>缓存
    <span class="token number">4</span><span class="token function">XX</span><span class="token punctuation">(</span>Client Error 客户端错误状态码<span class="token punctuation">)</span>
      <span class="token number">401</span><span class="token punctuation">:</span>没有权限
      <span class="token number">403</span><span class="token punctuation">:</span>登陆了 还是没有权限
      <span class="token number">404</span><span class="token punctuation">:</span>找不到资源
    <span class="token number">5</span><span class="token function">XX</span><span class="token punctuation">(</span>Server Error 服务器错误状态码<span class="token punctuation">)</span>
      <span class="token number">500</span><span class="token punctuation">:</span>服务器挂了
      <span class="token number">503</span><span class="token punctuation">:</span>负载均衡超标
</code></pre></div><p>请求(一对)</p> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>get / post / put / delete / options(预发射/试探性,在跨域的时候用到) / head</p> <p>资源url (/form/entry/)</p> <p>协议版本(HTTP/1.1)</p> <p>Host: hacker.jp  请求头</p> <p>Connection: keep-alive</p> <p>Connection-Type:application/x-www-form-urlencoded</p> <p>Content-Length:16</p></div> <p><strong>模拟最简陋的client</strong></p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// node中核心模块 http模块 专门用来创建http服务的</span>
<span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// http.get 他只能发送get请求（没有请求体）</span>
<span class="token comment">// post localhost:3000/path</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  host<span class="token punctuation">:</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
  method<span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">,</span>
  path<span class="token punctuation">:</span><span class="token string">'/user?a=1&amp;b=2#hash'</span><span class="token punctuation">,</span>
  headers<span class="token punctuation">:</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">'seven'</span><span class="token punctuation">,</span>
    <span class="token string">'Content-Type'</span><span class="token punctuation">:</span><span class="token string">'application/x-www-form-urlencoded'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 请求体</span>
client<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'age=9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>搭建最简陋的server</strong></p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//req 相当于是可以端的请求 可读流</span>
<span class="token comment">//res 是代表稍后我要写响应 可写流</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 请求的方法就是大写的</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//POST</span>
  <span class="token comment">// 从/后面到#前面的部分(浏览器环境) </span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// /user?a=1&amp;b=2</span>
  <span class="token comment">// 请求头都是小写的 content-type</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 对象</span>

  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果有请求体会触发on('data')事件，如果没有请求体会触发on('end')事件，不管有没有请求体 end事件都会触发</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求替'</span><span class="token punctuation">)</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//接收的数据</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 表示结束了</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">,</span><span class="token string">'localhost'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'3000端口启动了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="后端接受的数据"><a href="#后端接受的数据" aria-hidden="true" class="header-anchor">#</a> 后端接受的数据</h2> <ul><li>主要有3大类，第一个json，第二个form表单，第三个file类型</li> <li>每个数据格式都有对应的请求头</li> <li>json =&gt; &quot;Content-Type&quot;:&quot;application/json&quot;</li> <li>form =&gt; &quot;Content-Type&quot;:&quot;application/x-www-urlencoded&quot;</li> <li>file =&gt; 在html的form表单中 必须添加<code>enctype=&quot;multipart/form-data&quot;</code></li> <li>express 接受后端数据，主要是post提交(包含以上三种类型)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> multer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'multer'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> fs <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 处理json格式的请求体</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 处理表单格式的请求体</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>extended<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 文件上传 upload req.file获取文件的流   dest req.file 获取的保存路径</span>
<span class="token keyword">let</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>upload<span class="token punctuation">:</span><span class="token string">'upload/'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// var storage = multer.diskStorage({</span>
<span class="token comment">//   destination: function (req, file, cb) {</span>
<span class="token comment">//     cb(null,path.join(__dirname,'/upload'))</span>
<span class="token comment">//   },</span>
<span class="token comment">//   filename: function (req, file, cb) {</span>
<span class="token comment">//     cb(null, Date.now() + &quot;-&quot; + file.originalname)</span>
<span class="token comment">//   }</span>
<span class="token comment">// })</span>
<span class="token comment">// let upload = multer({storage:storage})</span>

app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/post'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/form'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> body <span class="token operator">=</span> req<span class="token punctuation">.</span>body
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 只有一个文件类型的用upload.single('avatar') 处理</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">,</span>upload<span class="token punctuation">.</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token string">'avatar'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// req.file 里面存放的文件类型的数据</span>
  <span class="token comment">// req.body 里面存放的普通类型的数据</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>name<span class="token punctuation">,</span><span class="token keyword">typeof</span> req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//req.filr 指的是请求体formData里的avatar 字段对应的文件内容</span>
  <span class="token comment">// console.log(req.file.buffer); //req.filr 指的是请求体formData里的avatar 字段对应的文件内容</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token template-string"><span class="token string">`upload/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>originalname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>req<span class="token punctuation">.</span>file<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="客户端"><a href="#客户端" aria-hidden="true" class="header-anchor">#</a> 客户端</h3> <h2 id="常用的库"><a href="#常用的库" aria-hidden="true" class="header-anchor">#</a> 常用的库</h2> <p><strong>1、let mime = require('mime')</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 根据文件名的后缀 返回文件的内容类型</span>
<span class="token comment">// xx.html =&gt; text/html</span>
<span class="token comment">// xx.css =&gt; text/css </span>
  mime<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token string">'引入文件'</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>2、let fs = require('mz/fs')</strong></p> <p>mz需要引入 mz将fs所有的方法转换成promise</p> <p><strong>3、require('querystring').parse(str,'&amp;@','#=')</strong></p> <ul><li>parse方法专门 对特定的字符串<code>例如:xx=111&amp;name=sgh</code>处理和提取</li> <li>第一个参数是要处理的字符串,</li> <li>第二个参数是分隔符</li> <li>第三个是对象分隔符</li></ul> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>后面两个参数默认是 <span class="token string">'&amp;'</span> <span class="token string">'='</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">'username#=123&amp;@password#=456'</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span><span class="token string">'&amp;@'</span><span class="token punctuation">,</span><span class="token string">'#='</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token comment">//{ username: '123', password: '456' }</span>
</code></pre></div><p><strong>4、方法拷贝</strong></p> <ul><li>把一个对象的属性 拷贝到另一个对象上去</li> <li>express 源码用到这个</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> mixin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'merge-descriptors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mixin</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">mixin</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> proto<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">11/7/2022, 8:03:51 PM</span></div></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/Study-history/houduan/ios.html">
          ISO
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/Study-history/assets/js/app.a1ad6491.js" defer></script><script src="/Study-history/assets/js/48.d5004b5b.js" defer></script>
  </body>
</html>
