<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MongoDB | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/Study-history/assets/css/0.styles.e2241fa8.css" as="style"><link rel="preload" href="/Study-history/assets/js/app.a1ad6491.js" as="script"><link rel="preload" href="/Study-history/assets/js/47.72c2c6ba.js" as="script"><link rel="prefetch" href="/Study-history/assets/js/10.7e604d29.js"><link rel="prefetch" href="/Study-history/assets/js/11.3067a7ca.js"><link rel="prefetch" href="/Study-history/assets/js/12.d1a6fe69.js"><link rel="prefetch" href="/Study-history/assets/js/13.4864be39.js"><link rel="prefetch" href="/Study-history/assets/js/14.30636de0.js"><link rel="prefetch" href="/Study-history/assets/js/15.2bcbbae8.js"><link rel="prefetch" href="/Study-history/assets/js/16.9d7f8d82.js"><link rel="prefetch" href="/Study-history/assets/js/17.0b328dfe.js"><link rel="prefetch" href="/Study-history/assets/js/18.f73ae9e0.js"><link rel="prefetch" href="/Study-history/assets/js/19.0e9a993e.js"><link rel="prefetch" href="/Study-history/assets/js/2.d8f505d4.js"><link rel="prefetch" href="/Study-history/assets/js/20.1a0bbb82.js"><link rel="prefetch" href="/Study-history/assets/js/21.23696e8c.js"><link rel="prefetch" href="/Study-history/assets/js/22.0c73380e.js"><link rel="prefetch" href="/Study-history/assets/js/23.c3ff09bc.js"><link rel="prefetch" href="/Study-history/assets/js/24.7933ac39.js"><link rel="prefetch" href="/Study-history/assets/js/25.c8ae28e2.js"><link rel="prefetch" href="/Study-history/assets/js/26.3736bb12.js"><link rel="prefetch" href="/Study-history/assets/js/27.97f3f560.js"><link rel="prefetch" href="/Study-history/assets/js/28.fa4268d5.js"><link rel="prefetch" href="/Study-history/assets/js/29.50a00a75.js"><link rel="prefetch" href="/Study-history/assets/js/3.8796f9d7.js"><link rel="prefetch" href="/Study-history/assets/js/30.25371944.js"><link rel="prefetch" href="/Study-history/assets/js/31.b1b8fd04.js"><link rel="prefetch" href="/Study-history/assets/js/32.f534b2b4.js"><link rel="prefetch" href="/Study-history/assets/js/33.b9e3298a.js"><link rel="prefetch" href="/Study-history/assets/js/34.8ac7105e.js"><link rel="prefetch" href="/Study-history/assets/js/35.ba4dfc73.js"><link rel="prefetch" href="/Study-history/assets/js/36.ef19edf1.js"><link rel="prefetch" href="/Study-history/assets/js/37.0f9caf07.js"><link rel="prefetch" href="/Study-history/assets/js/38.2e4a8c9a.js"><link rel="prefetch" href="/Study-history/assets/js/39.46f87030.js"><link rel="prefetch" href="/Study-history/assets/js/4.c59777f9.js"><link rel="prefetch" href="/Study-history/assets/js/40.e1794eae.js"><link rel="prefetch" href="/Study-history/assets/js/41.5507fc07.js"><link rel="prefetch" href="/Study-history/assets/js/42.caa5814b.js"><link rel="prefetch" href="/Study-history/assets/js/43.6cd8bb3f.js"><link rel="prefetch" href="/Study-history/assets/js/44.2442f75f.js"><link rel="prefetch" href="/Study-history/assets/js/45.9648c0bd.js"><link rel="prefetch" href="/Study-history/assets/js/46.de6e3a74.js"><link rel="prefetch" href="/Study-history/assets/js/48.d5004b5b.js"><link rel="prefetch" href="/Study-history/assets/js/49.a2d1d664.js"><link rel="prefetch" href="/Study-history/assets/js/5.9b395665.js"><link rel="prefetch" href="/Study-history/assets/js/50.19b7d6c9.js"><link rel="prefetch" href="/Study-history/assets/js/51.a9a0da08.js"><link rel="prefetch" href="/Study-history/assets/js/52.e99771cc.js"><link rel="prefetch" href="/Study-history/assets/js/53.74e55a43.js"><link rel="prefetch" href="/Study-history/assets/js/54.c4ff7ebc.js"><link rel="prefetch" href="/Study-history/assets/js/55.acadfba7.js"><link rel="prefetch" href="/Study-history/assets/js/56.8fa49260.js"><link rel="prefetch" href="/Study-history/assets/js/57.08f5f4e4.js"><link rel="prefetch" href="/Study-history/assets/js/58.9d13dd4c.js"><link rel="prefetch" href="/Study-history/assets/js/6.d5fd31a3.js"><link rel="prefetch" href="/Study-history/assets/js/7.ec2eb6b8.js"><link rel="prefetch" href="/Study-history/assets/js/8.91dd34c9.js"><link rel="prefetch" href="/Study-history/assets/js/9.814e5587.js">
    <link rel="stylesheet" href="/Study-history/assets/css/0.styles.e2241fa8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Study-history/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Study-history/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/Study-history/houduan/" class="nav-link router-link-active">back</a></div><div class="nav-item"><a href="/Study-history/devOps/" class="nav-link">devOps</a></div><div class="nav-item"><a href="/Study-history/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/Study-history/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/songge7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Study-history/front/" class="nav-link">front</a></div><div class="nav-item"><a href="/Study-history/houduan/" class="nav-link router-link-active">back</a></div><div class="nav-item"><a href="/Study-history/devOps/" class="nav-link">devOps</a></div><div class="nav-item"><a href="/Study-history/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/Study-history/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/songge7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>houduan</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/Study-history/houduan/node.html" class="sidebar-link">node</a></li><li><a href="/Study-history/houduan/ios.html" class="sidebar-link">ISO</a></li><li><a href="/Study-history/houduan/mongodb.html" class="active sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Study-history/houduan/mongodb.html#mongodb-2" class="sidebar-link">MongoDB</a></li><li class="sidebar-sub-header"><a href="/Study-history/houduan/mongodb.html#mongoose" class="sidebar-link">mongoose</a></li></ul></li><li><a href="/Study-history/houduan/mock.html" class="sidebar-link">Mockjs</a></li><li><a href="/Study-history/houduan/koa.html" class="sidebar-link">koa原理</a></li><li><a href="/Study-history/houduan/http.html" class="sidebar-link">http</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="mongodb"><a href="#mongodb" aria-hidden="true" class="header-anchor">#</a> MongoDB</h1> <h2 id="mongodb-2"><a href="#mongodb-2" aria-hidden="true" class="header-anchor">#</a> MongoDB</h2> <ul><li>基本概念
<ul><li>数据库:mongoDB的单个实例可以容纳多个独立的数据库</li> <li>集合:数据库是由集合组成,一个集合用来表示一个实体</li> <li>文档:集合是由文档组成的,一个文档表示一条记录</li></ul></li> <li>安装
<ul><li><a href="https://pan.baidu.com/s/1EkAB2SrcU1mfMfff_WDxtA" target="_blank" rel="noopener noreferrer">MongoDB64位绿色版 链接:<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  密码: w913</li></ul></li> <li>启动(默认端口号 27017)
<ul><li>打开安装的bin目录(mongod.exe 是开启服务的) cmd</li> <li>服务端  mongod --dbpath=./data   ./data 就是存储数据的 可以随便指定</li> <li>客户 客户端开启 mongo</li></ul></li> <li>添加环境变量就能在任何目录下 输入命令了
<ul><li>在环境变量的 path 里添加 bin 的目录</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code> 基本指令操作<span class="token punctuation">:</span>
	
	<span class="token number">1</span>、操作数据库
	show dbs 显示数据库
	use xxx  切换数据库<span class="token operator">/</span>若没有 就是创建
	db  查看当前使用的数据库
	db<span class="token punctuation">.</span><span class="token function">dropDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 删除数据库
		
	<span class="token number">2</span><span class="token function">、操作集合</span> <span class="token punctuation">(</span>xxx 代表集合名字<span class="token punctuation">)</span>
	show collections  查看集合
	db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> 创建空集合
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		删除集合 
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 查看数据库所有字段

	<span class="token number">3</span>、更新文档
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  更新后就只有name属性 其他的都没了
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$<span class="token keyword">set</span><span class="token punctuation">:</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  只更新name属性
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$inc<span class="token punctuation">:</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span>  累加 第一个参数没有给就给所有的文档 name都加<span class="token number">1</span>
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'xx'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>upsert<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  更新插入
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$<span class="token punctuation">{</span><span class="token keyword">set</span><span class="token punctuation">:</span>name<span class="token punctuation">:</span><span class="token string">'xx'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>	默认更新匹配到的第一条
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$<span class="token punctuation">{</span><span class="token keyword">set</span><span class="token punctuation">:</span>name<span class="token punctuation">:</span><span class="token string">'xx'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>multi<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>	若是要更新所有 加第三个参数
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$unset<span class="token punctuation">:</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span>xx<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>	删除文档的指定字段

	往数组加数据
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$push<span class="token punctuation">:</span><span class="token punctuation">{</span>hobbies<span class="token punctuation">:</span><span class="token string">'smokeing'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span>重复执行 就添加<span class="token number">2</span>条一样的<span class="token punctuation">)</span>
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$addToSet<span class="token punctuation">:</span><span class="token punctuation">{</span>hobbies<span class="token punctuation">:</span><span class="token string">'drinking'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 不会添加重复的    
	将数组放置 数组内 而且平铺
		<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">]</span>
		db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$addToSet<span class="token punctuation">:</span><span class="token punctuation">{</span>hobbies<span class="token punctuation">:</span><span class="token punctuation">{</span>$each<span class="token punctuation">:</span>arr<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>$pop<span class="token punctuation">:</span><span class="token punctuation">{</span>hobbies<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 删除数组内的

	
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>_id<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 删除 删除所有匹配的记录
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>justOne<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 删除匹配的第一条

	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 查询 默认查询所有
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 只返回 有name的 也只返回name和_id  name后面的<span class="token number">0</span>表示不出现  <span class="token number">1</span>表示出现 _id 默认出现	
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 这样就是除了name列 其他都出现
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>	第二个参数 除了_id 不能即出现<span class="token number">0</span>又出现<span class="token number">1</span>  一般 只要<span class="token number">1</span>或少数字段 就用<span class="token number">1</span><span class="token punctuation">,</span>要多数字段就用<span class="token number">0</span>

	写正则
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'123566'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	查找都可以
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token regex">/^123/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token regex">/23/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	分页
	skip 跳过指定的条数
	limt 限制返回的条数
	exec 开始执行
	sort age代表里面的字段 <span class="token number">1</span>代表升序 <span class="token operator">-</span><span class="token number">1</span><span class="token function">代表降序</span> <span class="token punctuation">(</span>默认是按照_id排序<span class="token punctuation">)</span>
	有sort的情况 先排序 在算skip <span class="token function">limt</span><span class="token punctuation">(</span>因为 查询是异步<span class="token punctuation">)</span>  sort放前放后都可以
	db<span class="token punctuation">.</span>stu<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	         
	备份 
	将school数据备份到<span class="token punctuation">.</span><span class="token operator">/</span>bk文件里面
	mongodump <span class="token operator">--</span>out <span class="token punctuation">.</span><span class="token operator">/</span>bk <span class="token operator">--</span>collection stu <span class="token operator">--</span>db school
	导入 将备份的文件还原到数据库
	mongorestore <span class="token punctuation">.</span><span class="token operator">/</span>bk
</code></pre></div><h2 id="mongoose"><a href="#mongoose" aria-hidden="true" class="header-anchor">#</a> mongoose</h2> <blockquote><p>是mongodb的一个对象模型工具</p></blockquote> <ul><li>Schema 数据库集合的模型骨架</li> <li>数据类型
<ul><li>NodeJs中基本数据类型都属于Schema.Type</li> <li>mongoose.Schema.Types.ObjectId (ObjectId 在mongoose实例下才能获取到的类型)</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> personSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			name<span class="token punctuation">:</span>String<span class="token punctuation">,</span> <span class="token comment">//姓名</span>
			binary<span class="token punctuation">:</span>Buffer<span class="token punctuation">,</span><span class="token comment">//二进制</span>
			living<span class="token punctuation">:</span>Boolean<span class="token punctuation">,</span><span class="token comment">//是否活着</span>
			birthday<span class="token punctuation">:</span>Date<span class="token punctuation">,</span><span class="token comment">//生日</span>
			age<span class="token punctuation">:</span>Number<span class="token punctuation">,</span><span class="token comment">//年龄</span>
			_id<span class="token punctuation">:</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>  <span class="token comment">//主键</span>
			_fk<span class="token punctuation">:</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span>  <span class="token comment">//外键</span>
			array<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//数组</span>
			arrOfString<span class="token punctuation">:</span><span class="token punctuation">[</span>String<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//字符串数组</span>
			arrOfNumber<span class="token punctuation">:</span><span class="token punctuation">[</span>Number<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//数字数组</span>
			arrOfDate<span class="token punctuation">:</span><span class="token punctuation">[</span>Date<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//日期数组</span>
			arrOfBuffer<span class="token punctuation">:</span><span class="token punctuation">[</span>Buffer<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//Buffer数组</span>
			arrOfBoolean<span class="token punctuation">:</span><span class="token punctuation">[</span>Boolean<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//布尔值数组</span>
			arrOfObjectId<span class="token punctuation">:</span><span class="token punctuation">[</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">]</span><span class="token comment">//对象ID数组</span>
			nested<span class="token punctuation">:</span><span class="token punctuation">{</span> <span class="token comment">//内嵌文档</span>
					name<span class="token punctuation">:</span>String<span class="token punctuation">,</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>配合node使用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//useNewUrlParser这个属性会在url里识别验证用户所需的db</span>
<span class="token comment">// test 是数据库的名字 随意写</span>
<span class="token keyword">const</span> conn <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/test'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> UserSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    username<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>String<span class="token punctuation">,</span>required<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span>String<span class="token punctuation">,</span>
    age<span class="token punctuation">:</span>Number<span class="token punctuation">,</span>
    createAt<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>Date<span class="token punctuation">,</span><span class="token keyword">default</span><span class="token punctuation">:</span>Date<span class="token punctuation">.</span>now<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>collection<span class="token punctuation">:</span><span class="token string">'user'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//集合的名字是来自于模型的名字, 模型名&gt;小写&gt;复数</span>
<span class="token keyword">let</span> User <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'sd'</span><span class="token punctuation">,</span>UserSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//插入文档 可放单个 也可以放文档</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//  User.create添加数据</span>
    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        username<span class="token punctuation">:</span><span class="token string">'lisi'</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span><span class="token string">'123456'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span>
    <span class="token comment">// User.updateOne 更新第一条数据</span>
    <span class="token comment">// User.updateMany 更新多条</span>
    <span class="token comment">// 第一个参数是更新的条件 第二个参数是要更新的内容</span>
    <span class="token keyword">let</span> updateResult <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token punctuation">:</span><span class="token string">'lisi'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token number">121</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>updateResult<span class="token punctuation">)</span>
    <span class="token comment">// User.find 查询数据</span>
    <span class="token comment">// User.findOne 查询一条</span>
    <span class="token keyword">let</span> queryResult <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token punctuation">:</span><span class="token string">'lisi'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>username<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 通过ID查找</span>
    <span class="token keyword">let</span> rs1 <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">'5ca0c6e7c4b03802b8f03587'</span><span class="token punctuation">)</span>
    <span class="token comment">// $exist:true 表示age字段要存在  $gt:1,$lte:10 表示age 1&lt;age=&lt;10  username在lisi或者张三之间</span>
    <span class="token keyword">let</span> rs2 <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>age<span class="token punctuation">:</span><span class="token punctuation">{</span>$exist<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token punctuation">{</span>$gt<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>$lte<span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>username<span class="token punctuation">:</span><span class="token punctuation">{</span>$<span class="token keyword">in</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'lisi'</span><span class="token punctuation">,</span><span class="token string">'张三'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'queryResult'</span><span class="token punctuation">,</span>rs2<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre></div><ul><li>主外键联合</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// 主外键 绑定</span>
<span class="token keyword">let</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ObjectId 类型是 mongoose 自带的</span>
<span class="token keyword">let</span> ObjectId <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId
<span class="token keyword">const</span> conn <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/sg'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>useNewUrlParser<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> UserSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    username<span class="token punctuation">:</span>String<span class="token punctuation">,</span>
    password<span class="token punctuation">:</span>String<span class="token punctuation">,</span>
    createAt<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>Date<span class="token punctuation">,</span><span class="token keyword">default</span><span class="token punctuation">:</span>Date<span class="token punctuation">.</span>now<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> UserModel <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User12'</span><span class="token punctuation">,</span>UserSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> ArticleShema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token punctuation">:</span>String<span class="token punctuation">,</span>
    content<span class="token punctuation">:</span>String<span class="token punctuation">,</span>
    <span class="token comment">// 类似主外键 ref 指向 要绑定的User</span>
    User1<span class="token punctuation">:</span><span class="token punctuation">{</span>type<span class="token punctuation">:</span>ObjectId<span class="token punctuation">,</span>ref<span class="token punctuation">:</span><span class="token string">'User12'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ArticleModel <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Article'</span><span class="token punctuation">,</span>ArticleShema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 联表操作</span>
<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token keyword">await</span> UserModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>username<span class="token punctuation">:</span><span class="token string">'wangwu'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> article <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span><span class="token string">'标题'</span><span class="token punctuation">,</span>content<span class="token punctuation">:</span><span class="token string">'内容'</span><span class="token punctuation">,</span>User1<span class="token punctuation">:</span>user<span class="token punctuation">.</span>_id<span class="token punctuation">}</span><span class="token punctuation">)</span>  
    <span class="token comment">//populate 里面的值 要指向ArticleModel 的key</span>
    <span class="token keyword">let</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'User1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'rs'</span><span class="token punctuation">,</span>rs<span class="token punctuation">)</span>
    <span class="token comment">/*
        let userId = article.user;
        let rs = await User.findById(userId)
        console.log('rs',rs)
     */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">11/7/2022, 8:03:51 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Study-history/houduan/ios.html" class="prev">
          ISO
        </a></span> <span class="next"><a href="/Study-history/houduan/mock.html">
          Mockjs
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/Study-history/assets/js/app.a1ad6491.js" defer></script><script src="/Study-history/assets/js/47.72c2c6ba.js" defer></script>
  </body>
</html>
